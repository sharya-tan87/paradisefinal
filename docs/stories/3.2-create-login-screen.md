# Story 3.2: Create Login Screen (Branded)

## Status
Done

## Story
**As a** System User (Staff, Dentist, Manager, Admin, or Patient),
**I want** a branded login screen that follows clinic design guidelines,
**so that** I can authenticate and access the system with a professional, trustworthy interface.

## Acceptance Criteria
1. Login page uses brand three-color system ONLY: `#CEE0F3`, `#2D7C9C`, `#214491` plus white `#FFFFFF`
2. Login page background is pure white (`#FFFFFF`)
3. Login form uses Prompt font family exclusively
4. Login form includes username and password input fields with proper labels
5. Submit button uses Teal Blue (`#2D7C9C`) with hover state Deep Navy (`#214491`)
6. Form validation displays inline error messages for empty fields
7. API authentication errors display above the form in branded error container
8. Login form is centered on page with responsive layout (mobile-first)
9. Form uses React Hook Form for state management
10. Successful login stores JWT tokens and redirects based on user role
11. Password field has toggle visibility icon (eye/eye-off from Lucide React)
12. Login page includes clinic logo/name at top of form
13. Form card has rounded corners (12px border-radius) and soft shadow
14. Loading state displays during authentication (button disabled with spinner)
15. "Remember me" checkbox is NOT included (security best practice for medical data)

## Tasks / Subtasks

- [x] **Task 1: Create LoginPage Component** (AC: 1, 2, 3, 8, 12, 13)
  - [x] Create `frontend/src/pages/LoginPage.jsx`
  - [x] Set up component structure with white background (`bg-white`)
  - [x] Center login form card on viewport
  - [x] Add clinic logo/name heading at top using brand colors
  - [x] Use Prompt font throughout (`font-prompt`)
  - [x] Implement responsive layout (mobile-first approach)

- [x] **Task 2: Implement Login Form with React Hook Form** (AC: 4, 6, 9)
  - [x] Set up React Hook Form with `useForm` hook
  - [x] Create username input field:
    - [x] Label: "Username" in Deep Navy (`text-primary-900`)
    - [x] Input styling: white background, gray border, rounded (`rounded-lg`)
    - [x] Required validation with error message "Username is required"
  - [x] Create password input field:
    - [x] Label: "Password" in Deep Navy (`text-primary-900`)
    - [x] Input type="password" with same styling as username
    - [x] Required validation with error message "Password is required"
  - [x] Display inline validation errors below each field (`text-red-600 font-prompt text-sm`)

- [x] **Task 3: Add Password Visibility Toggle** (AC: 11)
  - [x] Import Eye and EyeOff icons from Lucide React
  - [x] Add toggle button inside password field (absolute positioning)
  - [x] Implement state to track password visibility (show/hide)
  - [x] Toggle input type between "password" and "text"
  - [x] Style icon in Teal Blue (`text-primary-500`)

- [x] **Task 4: Style Submit Button** (AC: 5, 14)
  - [x] Create submit button with text "Sign In"
  - [x] Style: `bg-primary-500 text-white rounded-lg px-6 py-3 hover:bg-primary-900 transition-colors shadow-sm`
  - [x] Disable button during form submission (`disabled:opacity-50 disabled:cursor-not-allowed`)
  - [x] Show loading spinner (Loader2 icon from Lucide React) when `isSubmitting` is true
  - [x] Full-width button on mobile, fixed width on desktop

- [x] **Task 5: Implement Authentication Logic** (AC: 7, 10, 14)
  - [x] Create `handleSubmit` function to call login API
  - [x] Use axios to POST to `/api/auth/login` with username and password
  - [x] On success:
    - [x] Store `accessToken` in localStorage
    - [x] Store `refreshToken` in localStorage
    - [x] Store user data (id, username, role, email) in localStorage or context
    - [x] Redirect to appropriate dashboard based on user role
  - [x] On error (401):
    - [x] Display error message above form in error container
    - [x] Style error: `bg-red-50 border border-red-200 rounded-lg p-4 mb-6`
    - [x] Error text: `text-red-700 font-prompt text-sm`

- [x] **Task 6: Implement Role-Based Redirect Logic** (AC: 10)
  - [x] After successful login, check user.role from response
  - [x] Redirect based on role:
    - [x] `admin` or `manager` → `/dashboard/admin`
    - [x] `dentist` or `staff` → `/dashboard/staff`
    - [x] `patient` → `/dashboard/patient`
    - [x] Use React Router's `useNavigate` for programmatic navigation

- [x] **Task 7: Create Login API Service Function** (AC: 10)
  - [x] Create or update `frontend/src/services/api.js`
  - [x] Add `login(username, password)` function
  - [x] Function returns axios POST to `/api/auth/login`
  - [x] Handle response and error properly
  - [x] Export function for use in LoginPage

- [x] **Task 8: Add Protected Route Logic** (AC: 10)
  - [x] Create `frontend/src/components/ProtectedRoute.jsx` component
  - [x] Check for accessToken in localStorage
  - [x] If token exists, render children
  - [x] If no token, redirect to `/login`
  - [x] Wrap dashboard routes with ProtectedRoute in App.jsx

- [x] **Task 9: Update App Routing** (AC: 10)
  - [x] Add `/login` route in `frontend/src/App.jsx`
  - [x] Set LoginPage as component for `/login` route
  - [x] Redirect root `/` to `/login` if not authenticated (Skipped: Maintained HomePage as public root)
  - [x] Add placeholder dashboard routes (`/dashboard/admin`, `/dashboard/staff`, `/dashboard/patient`)

- [x] **Task 10: Testing and Validation**
  - [x] Test empty form submission → inline validation errors display
  - [x] Test invalid credentials → API error displays above form
  - [x] Test valid admin credentials → redirects to `/dashboard/admin`
  - [x] Test valid staff credentials → redirects to `/dashboard/staff`
  - [x] Test valid patient credentials → redirects to `/dashboard/patient`
  - [x] Test password visibility toggle → password shows/hides correctly
  - [x] Test responsive layout → form centers on mobile and desktop
  - [x] Verify all brand colors used correctly (no other colors)
  - [x] Verify Prompt font used throughout
  - [x] Test loading state → button disabled and spinner shows during API call

## Dev Notes

### Previous Story Context
[Source: Story 3.1 Dev Agent Record - To be completed]

Story 3.1 will implement:
- JWT authentication backend (`POST /api/auth/login`)
- Access token (15m expiry) and refresh token (7d expiry)
- Response format: `{ success: true, accessToken, refreshToken, user: { id, username, role, email } }`
- Error format: `{ message: 'Invalid credentials' }` for 401 responses

**Dependency:** This story REQUIRES Story 3.1 to be completed first.

### Technology Stack
[Source: docs/architecture/2-technology-stack.md]

**Frontend Stack:**
- Framework: React 18.x
- UI Framework: Tailwind CSS 3.x (brand configuration)
- Forms: React Hook Form + Yup (validation)
- Icons: Lucide React (outline/line style)
- Router: React Router (for navigation and protected routes)
- HTTP Client: Axios (for API calls)
- Font: Google Fonts (Prompt)

**Dependencies to verify are installed:**
- `react-hook-form` (already used in Story 2.1)
- `lucide-react` (already used in Story 2.1)
- `react-router-dom` (for routing)
- `axios` (for API calls)

### Brand Compliance Requirements
[Source: docs/prd/8-uiux-specifications.md]

**Strict Three-Color System:**
- **Deep Navy (`#214491`)**: Headings, labels, primary text
- **Teal Blue (`#2D7C9C`)**: Submit button background, icons, focus states
- **Light Blue (`#CEE0F3`)**: Card borders, subtle highlights
- **White (`#FFFFFF`)**: Page background, card background, button text

**Button Specifications:**
```css
Primary Button (Submit):
- Background: #2D7C9C (Teal Blue)
- Text: #FFFFFF (White)
- Border-radius: 8px
- Font: Prompt SemiBold (600)
- Hover: Background → #214491 (Deep Navy)
- Padding: 12px 24px
- Shadow: 0 2px 4px rgba(0, 0, 0, 0.1)
```

**Card Specifications:**
```css
Login Form Card:
- Background: #FFFFFF (White)
- Border: 1px solid #CEE0F3 (Light Blue)
- Border-radius: 12px
- Padding: 32px (desktop), 24px (mobile)
- Shadow: 0 4px 12px rgba(33, 68, 145, 0.08)
- Max-width: 400px
```

**Input Field Specifications:**
```css
Text Input:
- Background: #FFFFFF (White)
- Border: 1px solid #E5E7EB (gray-200)
- Border-radius: 8px
- Padding: 12px 16px
- Font: Prompt Regular (400), 16px
- Focus: border-color: #2D7C9C, ring: 2px #CEE0F3
```

### Frontend Architecture Patterns
[Source: docs/architecture/3-frontend-architecture-ux-patterns.md]

**Component Styling Classes:**
- Primary Button: `bg-primary-500 text-white rounded-lg px-4 py-2 hover:bg-primary-600 transition-colors shadow-sm`
- Card: `bg-white rounded-xl border border-gray-100 shadow-soft p-6`
- Input: `bg-white border border-gray-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary-100 focus:border-primary-500 outline-none`

**Responsive Design:**
- Mobile-first approach
- Center login card vertically and horizontally on viewport
- Full-width card on mobile (with margin), max-width 400px on desktop

### Authentication Flow
[Source: docs/architecture/4-authentication-architecture-jwt-only.md]

**Login Flow:**
1. User submits username and password
2. Frontend POSTs to `/api/auth/login`
3. Backend validates credentials and returns:
   ```json
   {
     "success": true,
     "accessToken": "eyJhbGc...",
     "refreshToken": "eyJhbGc...",
     "user": {
       "id": "uuid",
       "username": "admin",
       "role": "admin",
       "email": "admin@example.com"
     }
   }
   ```
4. Frontend stores tokens in localStorage:
   - `localStorage.setItem('accessToken', response.accessToken)`
   - `localStorage.setItem('refreshToken', response.refreshToken)`
   - `localStorage.setItem('user', JSON.stringify(response.user))`
5. Frontend redirects to role-appropriate dashboard

**Error Handling:**
- 401 Unauthorized: `{ message: 'Invalid credentials' }`
- Display error above form, clear on next submission attempt

### Role-Based Redirect Logic
[Source: docs/prd/1-user-roles-access-hierarchy.md]

**Redirect Mapping:**
- `admin` → `/dashboard/admin` (full system access)
- `manager` → `/dashboard/admin` (same as admin for now)
- `dentist` → `/dashboard/staff` (clinical operations)
- `staff` → `/dashboard/staff` (front office operations)
- `patient` → `/dashboard/patient` (self-service portal)

Note: Detailed dashboard implementations will come in Stories 3.4 and 3.5. For now, create placeholder pages.

### File Locations
[Source: Existing frontend structure from Story 2.1]

**Frontend File Structure:**
```
frontend/src/
├── pages/
│   ├── HomePage.jsx (already exists)
│   ├── BookingPage.jsx (already exists)
│   └── LoginPage.jsx (NEW - create in this story)
├── components/
│   ├── Header.jsx (already exists)
│   ├── Footer.jsx (already exists)
│   └── ProtectedRoute.jsx (NEW - create in this story)
├── services/
│   └── api.js (already exists - add login function)
├── App.jsx (update with login route and protected routes)
└── index.css (Tailwind imports - already configured)
```

### Security Considerations
[Source: docs/prd/3-non-functional-requirements-nfrs.md]

**NFR S-SEC-003:** Access Control must be strictly enforced at the database/API level, not just the UI.
- Protected routes check for token presence, but actual authorization happens on backend
- Frontend validation is for UX only, not security

**Best Practices:**
- Store tokens in localStorage (simpler for shared hosting than HTTP-only cookies)
- No "Remember me" checkbox (security requirement for medical data)
- Clear tokens on logout
- Redirect to login if token is missing or expired

### Form Validation Pattern
[Source: Story 2.1 and 2.4 implementation]

**React Hook Form Setup:**
```javascript
import { useForm } from 'react-hook-form';

const { register, handleSubmit, formState: { errors, isSubmitting } } = useForm({
  mode: 'onSubmit' // Only validate on submit for login
});

const onSubmit = async (data) => {
  try {
    const response = await login(data.username, data.password);
    // Store tokens and redirect
  } catch (error) {
    setApiError(error.response?.data?.message || 'An error occurred');
  }
};
```

**Validation Rules:**
- Username: required (simple presence check, no format validation)
- Password: required (no complexity requirements for login)

### API Service Pattern
[Source: Story 2.1 implementation]

**Existing API Service (`frontend/src/services/api.js`):**
```javascript
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3001/api';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json'
  }
});

// ADD THIS FUNCTION:
export const login = async (username, password) => {
  const response = await api.post('/auth/login', { username, password });
  return response.data;
};
```

### Testing Standards

**Manual Testing Requirements:**
[Source: Frontend testing pattern from Story 2.1]

**Test Scenarios:**
1. **UI/Brand Compliance:**
   - Verify only three brand colors used (`#CEE0F3`, `#2D7C9C`, `#214491` + white)
   - Verify white background on page
   - Verify Prompt font used throughout
   - Verify button hover state changes to Deep Navy
   - Verify rounded corners (12px on card, 8px on inputs/button)

2. **Form Validation:**
   - Submit empty form → "Username is required" and "Password is required" errors display
   - Submit only username → "Password is required" error displays
   - Submit only password → "Username is required" error displays

3. **Authentication Flow:**
   - Submit valid admin credentials → stores tokens, redirects to `/dashboard/admin`
   - Submit valid staff credentials → stores tokens, redirects to `/dashboard/staff`
   - Submit valid patient credentials → stores tokens, redirects to `/dashboard/patient`
   - Submit invalid credentials → displays "Invalid credentials" error above form
   - API error clears when form is resubmitted

4. **UX Features:**
   - Click eye icon → password becomes visible
   - Click eye-off icon → password becomes hidden
   - During API call → button disabled, spinner shows
   - After successful login → tokens exist in localStorage

5. **Responsive Design:**
   - Mobile (375px width) → form card full-width with margins
   - Desktop (1024px width) → form card centered, max-width 400px
   - Tablet (768px width) → form remains centered and readable

6. **Protected Routes:**
   - Navigate to `/dashboard/admin` without login → redirects to `/login`
   - Navigate to `/dashboard/staff` without login → redirects to `/login`
   - Login successfully → can access dashboard pages

**No automated tests required** - Manual testing sufficient per project pattern.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-13 | 1.0 | Initial story creation for Epic 3.2 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
