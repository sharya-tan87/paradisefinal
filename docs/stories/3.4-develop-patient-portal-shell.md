# Story 3.4: Develop Patient Portal Shell

## Status
Done

## Story
**As a** Patient,
**I want** a personal dashboard to view my profile information,
**so that** I can see my basic account details in a branded, user-friendly interface.

## Acceptance Criteria
1. Patient dashboard accessible at `/dashboard/patient` route
2. Dashboard displays welcome message with patient's name
3. Dashboard shows patient's profile information (username, email, role)
4. Page uses brand three-color system ONLY: `#CEE0F3`, `#2D7C9C`, `#214491` plus white
5. Page background is pure white (`#FFFFFF`)
6. Dashboard uses Prompt font family exclusively
7. Layout includes Header component with logout functionality
8. Layout includes Footer component at bottom
9. Profile information displayed in branded card component
10. Logout button clears tokens from localStorage and redirects to `/login`
11. Dashboard is protected route (requires authentication and patient role)
12. Page is responsive (mobile-first design)
13. Navigation placeholder for future features (appointments, history, billing)
14. User icon from Lucide React displayed next to profile information

## Tasks / Subtasks

- [x] **Task 1: Create PatientDashboard Component** (AC: 1, 2, 3, 4, 5, 6, 12)
  - [x] Create `frontend/src/pages/PatientDashboard.jsx`
  - [x] Set up component structure with white background
  - [x] Get user data from localStorage
  - [x] Display welcome message: "Welcome, {user.name}!"
  - [x] Use Prompt font throughout
  - [x] Implement mobile-first responsive layout

- [x] **Task 2: Create Profile Card Component** (AC: 3, 9, 14)
  - [x] Create branded card to display profile information
  - [x] Style card: white background, Light Blue border, 12px border-radius, soft shadow
  - [x] Display user icon (User from Lucide React) in Teal Blue
  - [x] Show username, email, and role
  - [x] Format role text with capital first letter
  - [x] Use Deep Navy for labels, regular text for values

- [x] **Task 3: Add Header with Logout** (AC: 7, 10)
  - [x] Import existing Header component
  - [x] Add logout button to Header (visible only when authenticated)
  - [x] Style logout button: Teal Blue background, white text, hover Deep Navy
  - [x] Implement `handleLogout` function:
    - [x] Remove `accessToken` from localStorage
    - [x] Remove `refreshToken` from localStorage
    - [x] Remove `user` from localStorage
    - [x] Navigate to `/login` using React Router

- [x] **Task 4: Add Footer Component** (AC: 8)
  - [x] Import existing Footer component
  - [x] Ensure Footer displays at bottom of page
  - [x] Verify brand colors maintained

- [x] **Task 5: Create Navigation Placeholder** (AC: 13)
  - [x] Add navigation section with links (disabled/placeholder):
    - [x] "My Appointments" (placeholder)
    - [x] "Treatment History" (placeholder)
    - [x] "My Invoices" (placeholder)
  - [x] Style nav items in sidebar or top navigation
  - [x] Use gray text to indicate coming soon features
  - [x] Display navigation using Lucide React icons (Calendar, FileText, Receipt)

- [x] **Task 6: Update App Routing** (AC: 1, 11)
  - [x] Add `/dashboard/patient` route in `App.jsx`
  - [x] Wrap route with ProtectedRoute component
  - [x] Set `allowedRoles={['patient', 'admin']}` (admin can view for testing)
  - [x] Import PatientDashboard component

- [x] **Task 7: Testing and Validation**
  - [x] Login as patient → redirects to `/dashboard/patient` → displays dashboard
  - [x] Verify welcome message shows patient's name
  - [x] Verify profile card shows username, email, role correctly
  - [x] Click logout button → clears localStorage → redirects to `/login`
  - [x] Verify only brand colors used (no other colors)
  - [x] Verify white background on page
  - [x] Verify Prompt font throughout
  - [x] Test responsive design on mobile (375px) and desktop (1024px)
  - [x] Login as admin → can access `/dashboard/patient` (role hierarchy)
  - [x] Login as staff → cannot access `/dashboard/patient` → redirects to `/unauthorized`
  - [x] Access `/dashboard/patient` without login → redirects to `/login`

## Dev Notes

### Previous Story Context
[Source: Stories 3.1, 3.2, 3.3 - To be completed]

Required implementations from previous stories:
- **Story 3.1:** JWT authentication, user data in token payload
- **Story 3.2:** Login page stores user data in localStorage, role-based redirect
- **Story 3.3:** ProtectedRoute component with `allowedRoles` prop, RBAC middleware

**Dependencies:** This story REQUIRES Stories 3.1, 3.2, and 3.3 to be completed first.

### Technology Stack
[Source: docs/architecture/2-technology-stack.md]

**Frontend:**
- React 18.x
- React Router for navigation
- Lucide React for icons
- Tailwind CSS for styling

**User Data Structure (from localStorage):**
```javascript
{
  id: "uuid",
  username: "patient1",
  role: "patient",
  email: "patient1@example.com"
}
```

### Brand Compliance
[Source: docs/prd/8-uiux-specifications.md]

**Dashboard Layout:**
- Pure white background (`#FFFFFF`)
- Deep Navy (`#214491`) for headings and labels
- Teal Blue (`#2D7C9C`) for buttons and icons
- Light Blue (`#CEE0F3`) for card borders and subtle highlights

**Profile Card:**
```css
Card:
- Background: #FFFFFF
- Border: 1px solid #CEE0F3
- Border-radius: 12px
- Padding: 24px
- Shadow: 0 4px 12px rgba(33, 68, 145, 0.08)
- Max-width: 600px
```

**Logout Button:**
```css
Button:
- Background: #2D7C9C (Teal Blue)
- Text: #FFFFFF (White)
- Border-radius: 8px
- Padding: 8px 16px
- Hover: Background → #214491 (Deep Navy)
```

### Component Structure
[Source: Frontend architecture from Story 2.1]

**Page Layout:**
```jsx
<div className="min-h-screen bg-white font-prompt flex flex-col">
  <Header />
  <main className="flex-grow py-8 px-4 sm:px-6 lg:px-8">
    {/* Dashboard content */}
  </main>
  <Footer />
</div>
```

### Logout Implementation
[Source: Authentication flow from Story 3.2]

**Logout Function:**
```javascript
import { useNavigate } from 'react-router-dom';

const handleLogout = () => {
  // Clear all auth data
  localStorage.removeItem('accessToken');
  localStorage.removeItem('refreshToken');
  localStorage.removeItem('user');

  // Redirect to login
  navigate('/login');
};
```

### Navigation Placeholder Pattern
[Source: UX requirements]

**Future Features (Placeholder Links):**
- My Appointments (Epic 4 - Queue Management)
- Treatment History (Epic 4 - Treatment Charting)
- My Invoices (Epic 4 - Billing)

Display as grayed-out links with "Coming Soon" badge or disabled state.

### Responsive Design
[Source: docs/architecture/3-frontend-architecture-ux-patterns.md]

**Mobile-First Approach:**
- Mobile (< 640px): Single column, full-width cards
- Tablet (640px - 1024px): Centered content, max-width containers
- Desktop (> 1024px): Wider layout, sidebar navigation possible

### File Locations
[Source: Frontend structure from Story 3.2]

**Frontend Files:**
```
frontend/src/
├── pages/
│   ├── PatientDashboard.jsx (NEW)
│   ├── LoginPage.jsx (from Story 3.2)
│   └── UnauthorizedPage.jsx (from Story 3.3)
├── components/
│   ├── Header.jsx (update with logout button)
│   ├── Footer.jsx (already exists)
│   └── ProtectedRoute.jsx (from Story 3.3)
└── App.jsx (add patient dashboard route)
```

### Testing Standards

**Manual Testing:**
1. **Authentication & Authorization:**
   - Patient user can access dashboard
   - Admin user can access dashboard (hierarchy)
   - Staff user cannot access (403/unauthorized redirect)
   - Unauthenticated user redirects to login

2. **UI/Brand Compliance:**
   - Only three brand colors plus white
   - Prompt font throughout
   - Correct button hover states (Teal → Deep Navy)
   - Card styling matches brand specifications

3. **Functionality:**
   - Welcome message displays correct patient name
   - Profile card shows all user fields
   - Logout clears localStorage
   - Logout redirects to login page
   - Cannot access dashboard after logout

4. **Responsive:**
   - Mobile view (375px): Cards stack, full-width
   - Desktop view (1024px): Cards centered, readable
   - No horizontal scroll on any viewport

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-13 | 1.0 | Initial story creation for Epic 3.4 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_
